generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

model Conversation {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    participants ConversationParticipant[]
    messages     Message[]

    @@index([updatedAt])
}

model ConversationParticipant {
    id         String    @id @default(uuid())
    lastReadAt DateTime?
    joinedAt   DateTime  @default(now())

    userId String

    conversationId String
    conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

    @@unique([userId, conversationId])
    @@index([userId])
    @@index([conversationId])
}

model Message {
    id        String   @id @default(uuid())
    content   String
    createdAt DateTime @default(now())

    senderId String

    conversationId String
    conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

    @@index([conversationId])
    @@index([senderId])
    @@index([createdAt])
}
